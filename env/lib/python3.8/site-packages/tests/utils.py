import os
import pkg_resources
import configparser

assets_path = pkg_resources.resource_filename("krules_py", "assets")


def recursive_imports_check(assets_folder, dst, exclude=()):
    src = os.path.join(assets_path, assets_folder)
    for item in os.listdir(src):
        item_path = os.path.join(src, item)
        if os.path.isfile(item_path):
            if item not in exclude:
                if _is_file_to_copy(item_path, item):
                    assert os.path.exists(os.path.join(dst, item))
            else:
                assert not os.path.exists(os.path.join(dst, item))

        elif os.path.isdir(item_path):
            new_dst = os.path.join(dst, item)
            if item != "__pycache__" and item not in exclude:
                assert os.path.exists(new_dst)
                recursive_imports_check(item_path, new_dst, exclude)
            else:
                assert not os.path.exists(new_dst)


def _is_file_to_copy(file_path, file_name):
    if file_name != "__init__.py":
        return True
    with open(file_path) as f:
        return len(f.read().strip(" \n\t")) > 0
