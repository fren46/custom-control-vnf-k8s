import subprocess
import os
import yaml
import pytest
from tests.utils import recursive_imports_check


@pytest.mark.parametrize("ruleset_name", ["test-rs", ])
def test_create(ruleset_name, tmpdir):
    os.chdir(tmpdir)
    subprocess.check_output(['krules-py', 'project', 'init', ".",
                             "--name", "test-project",
                             "--namespace", "test-ns",
                             "--docker-registry", "localhost:5000"
                             ])
    os.chdir("rulesets")
    expected_output = "Ruleset %s created successfully\n" % ruleset_name
    output = subprocess.check_output(['krules-py', 'ruleset', 'create', ruleset_name])
    assert output.decode("utf-8").endswith(expected_output)
    recursive_imports_check("ruleset_tmpl", ruleset_name, exclude=("triggers.yaml", ))
